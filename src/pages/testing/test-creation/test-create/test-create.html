<ion-header>
    <ion-navbar hideBackButton="true">
        <ion-title margin-left>
            Test
        </ion-title>
        <ion-buttons start>
            <button icon-only ion-button (click)="launchDialer()">
                <ion-icon name="ios-call-outline"></ion-icon>
            </button>
        </ion-buttons>
    </ion-navbar>
</ion-header>


<ion-content padding>
    <ion-list class="full-dividers-list">
        <ion-card class="card" *ngFor="let vehicle of testData.vehicles; let i = index">
            <button ion-item detail-none class="ion-item-title"
                    (click)="onVehicleDetails(vehicle)">
                <ion-img item-start class="vehicle-type-icon"
                         src="./assets/imgs/{{getVehicleTypeIconToShow(vehicle)}}-icon.svg" width="50"></ion-img>
                <h2>{{ vehicle.vrms[0].vrm }} ({{vehicle.techRecord[0].vehicleType}})</h2>
                <p>{{ vehicle.vin }}</p>
                <h3 item-end class="vehicle-details">Details</h3>
                <ion-icon item-end class="arrow-forward" name="arrow-forward"></ion-icon>
            </button>
            <button ion-item
                    detail-none
                    class="bottom-divider"
                    (click)="onOdometer(i)">
                <h3 class="odometer-reading">Odometer reading</h3>
                <h3 item-end
                    class="odometer-reading-status"
                    [ngClass]="{'odometer-reading-start': !doesOdometerDataExist(i)}">
                    {{getOdometerStringToBeDisplayed(i)}}
                </h3>
                <ion-icon item-end class="odometer-reading-icon"
                          [ngClass]="{'odometer-reading-icon-data': doesOdometerDataExist(i), 'odometer-reading-icon-no-data': !doesOdometerDataExist(i)}"
                          [name]="doesOdometerDataExist(i) ? 'checkmark' : 'arrow-forward'"></ion-icon>
            </button>
            <ion-list class="full-dividers-list">
                <ion-item-sliding *ngFor="let vehicleTest of vehicle.testTypes"
                                  #slidingItem>
                    <button ion-item
                            detail-none
                            (click)="openTest(vehicle, vehicleTest)"
                            class="bottom-divider"
                            [ngClass]="{'abandoned-test': isTestAbandoned(vehicleTest)}">
                        <h3 class="test-type">{{ vehicleTest.name }}</h3>
                        <h3 item-end class="test-type-status"
                            *ngIf="vehicleTest.hasPassed != null"
                            [ngClass]="vehicleTest.hasPassed ? 'test-type-pass' : 'test-type-fail'">
                            {{ vehicleTest.hasPassed ? 'Pass' : 'Fail' }}
                            <span *ngIf="vehicleTest.defects.length != 0">
                          - {{ vehicleTest.defects.length }} defects
                        </span>
                        </h3>
                        <h3 item-end class="test-type-status test-type-notcomplete"
                            *ngIf="isTestAbandoned(vehicleTest)">Abandoned</h3>
                        <h3 item-end class="test-type-status test-type-inProgress"
                            *ngIf="!vehicleTest.result">In progress</h3>
                        <ion-icon item-end class="arrow-forward" name="arrow-forward"></ion-icon>
                    </button>
                    <ion-item-options *ngIf="!isTestAbandoned(vehicleTest)">
                        <button ion-button
                                color="dark"
                                (click)="onAbandonVehicleTest(vehicleTest)">Abandon
                        </button>
                        <button ion-button
                                color="danger"
                                (click)="onRemoveVehicleTest(vehicle, vehicleTest, slidingItem)">Remove
                        </button>
                    </ion-item-options>
                </ion-item-sliding>
            </ion-list>

            <button class="btn-add-test" ion-item detail-none (click)="addVehicleTest(vehicle)"
                    [ngClass]="{'bottom-divider': vehicle.testTypes.length == 0}">
                <span *ngIf="vehicle.testTypes.length == 0">Add a test type</span>
                <span *ngIf="vehicle.testTypes.length != 0">Add a linked test</span>
                <ion-icon aria-hidden="true" name="ios-add-circle-outline" item-end></ion-icon>
            </button>
        </ion-card>

        <ion-card>
            <button class="btn-add-test" ion-item detail-none (click)="presentSearchVehicle()">
                <h3>Add a trailer</h3>
                <ion-icon aria-hidden="true" name="ios-add-circle-outline" item-end></ion-icon>
            </button>
        </ion-card>
    </ion-list>
</ion-content>

<ion-footer>
    <div class="footer-cta-section">
        <button ion-button block color="secondary" (click)="reviewTest()">Review & Confirm</button>
    </div>
    <ion-toolbar>
        <ion-buttons start>
            <button ion-button (click)="addWaitTime()">
                Wait time
            </button>
        </ion-buttons>
        <ion-buttons end>
            <button ion-button>
                ATF Issue
            </button>
            <button ion-button (click)="onCancel()">Cancel</button>
        </ion-buttons>
    </ion-toolbar>
</ion-footer>
